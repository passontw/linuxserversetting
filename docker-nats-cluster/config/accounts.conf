# =================================================================
# NATS JetStream Cluster - Advanced Access Control Configuration
# =================================================================
# 
# 本配置實現進階模式的 Access Control：
# 1. Account 隔離不同環境 (dev/staging/prod)  
# 2. Subject 權限精確控制
# 3. Rate limiting 防止服務濫用
# =================================================================

# 定義不同的 Account (多租戶隔離)
accounts: {
    # =============================================================
    # Admin Account - 系統管理員帳戶 (完整權限)
    # =============================================================
    ADMIN: {
        users: [
            {
                user: "admin"
                password: "nats123"
                permissions: {
                    publish: ">"      # 可發布所有主題
                    subscribe: ">"    # 可訂閱所有主題
                }
            }
        ]
        jetstream: {
            max_memory: 1GB
            max_file: 4GB
            max_streams: 100
            max_consumers: 1000
        }
    }

    # =============================================================  
    # Development Account - 開發環境隔離
    # =============================================================
    DEV: {
        users: [
            {
                user: "dev-user"
                password: "dev123"
                permissions: {
                    publish: [
                        "dev.>",           # 開發環境所有主題
                        "logs.dev.>",      # 開發日誌
                        "metrics.dev.>"    # 開發指標
                    ]
                    subscribe: [
                        "dev.>",
                        "logs.dev.>", 
                        "metrics.dev.>",
                        "_INBOX.>"         # 請求回應模式
                    ]
                }
                limits: {
                    max_subscriptions: 50
                    max_payload: 1048576    # 1MB
                    max_pending: 1024
                    max_msgs: 100          # 每秒最大訊息數
                }
            }
        ]
        jetstream: {
            max_memory: 512MB
            max_file: 2GB
            max_streams: 20
            max_consumers: 200
        }
    }

    # =============================================================
    # Production Account - 生產環境隔離  
    # =============================================================
    PROD: {
        users: [
            {
                user: "prod-user"
                password: "prod456"
                permissions: {
                    publish: [
                        "prod.>",          # 生產環境所有主題
                        "logs.prod.>",     # 生產日誌
                        "metrics.prod.>",  # 生產指標
                        "alerts.>"         # 告警系統
                    ]
                    subscribe: [
                        "prod.>",
                        "logs.prod.>",
                        "metrics.prod.>", 
                        "alerts.>",
                        "_INBOX.>"
                    ]
                }
                limits: {
                    max_subscriptions: 100
                    max_payload: 2097152    # 2MB
                    max_pending: 2048
                    max_msgs: 500          # 每秒最大訊息數
                }
            }
        ]
        jetstream: {
            max_memory: 1GB
            max_file: 4GB
            max_streams: 50
            max_consumers: 500
        }
    }

    # =============================================================
    # Microservices Account - 微服務專用帳戶 (細粒度權限控制)
    # =============================================================
    SERVICES: {
        users: [
            # 用戶服務
            {
                user: "user-service"
                password: "user789"
                permissions: {
                    publish: [
                        "services.user.>",      # 用戶服務相關
                        "events.user.>",        # 用戶事件
                        "notifications.user.>"  # 用戶通知
                    ]
                    subscribe: [
                        "services.user.>",
                        "events.auth.>",        # 認證事件
                        "commands.user.>",      # 用戶指令
                        "_INBOX.>"
                    ]
                }
                limits: {
                    max_subscriptions: 30
                    max_payload: 524288     # 512KB
                    max_pending: 512
                    max_msgs: 200
                }
            },
            # 訂單服務
            {
                user: "order-service"  
                password: "order789"
                permissions: {
                    publish: [
                        "services.order.>",
                        "events.order.>",
                        "notifications.order.>"
                    ]
                    subscribe: [
                        "services.order.>",
                        "events.user.>",        # 監聽用戶事件
                        "events.payment.>",     # 監聽支付事件
                        "commands.order.>",
                        "_INBOX.>"
                    ]
                }
                limits: {
                    max_subscriptions: 30
                    max_payload: 1048576    # 1MB
                    max_pending: 1024
                    max_msgs: 300
                }
            },
            # 支付服務
            {
                user: "payment-service"
                password: "payment789"
                permissions: {
                    publish: [
                        "services.payment.>",
                        "events.payment.>", 
                        "notifications.payment.>"
                    ]
                    subscribe: [
                        "services.payment.>",
                        "events.order.>",       # 監聽訂單事件
                        "commands.payment.>",
                        "_INBOX.>"
                    ]
                }
                limits: {
                    max_subscriptions: 20
                    max_payload: 524288     # 512KB
                    max_pending: 256
                    max_msgs: 150
                }
            },
            # 通知服務
            {
                user: "notification-service"
                password: "notify789"
                permissions: {
                    publish: [
                        "notifications.send.>",
                        "events.notification.>"
                    ]
                    subscribe: [
                        "notifications.>",      # 接收所有通知請求
                        "events.user.>",
                        "events.order.>", 
                        "events.payment.>",
                        "_INBOX.>"
                    ]
                }
                limits: {
                    max_subscriptions: 50
                    max_payload: 262144     # 256KB
                    max_pending: 512
                    max_msgs: 100
                }
            }
        ]
        jetstream: {
            max_memory: 512MB
            max_file: 2GB
            max_streams: 30
            max_consumers: 300
        }
    }

    # =============================================================
    # Monitoring Account - 監控與日誌系統專用
    # =============================================================
    MONITORING: {
        users: [
            {
                user: "monitor-user"
                password: "monitor123"
                permissions: {
                    publish: [
                        "metrics.>",
                        "logs.>",
                        "health.>"
                    ]
                    subscribe: [
                        ">",               # 監控需要訂閱所有主題
                        "$SYS.>"          # 系統統計資訊
                    ]
                }
                limits: {
                    max_subscriptions: 200
                    max_payload: 1048576    # 1MB
                    max_pending: 2048
                    max_msgs: 1000         # 高頻監控需求
                }
            }
        ]
        jetstream: {
            max_memory: 256MB
            max_file: 1GB
            max_streams: 10
            max_consumers: 100
        }
    }
}

# =================================================================
# 系統帳戶 (必要設定)
# =================================================================
system_account: "ADMIN"

# =================================================================
# 預設帳戶對應關係
# =================================================================  
# 如果客戶端沒有指定帳戶，將使用 DEV 帳戶
# 生產環境建議移除此設定，強制指定帳戶
# ================================================================= 